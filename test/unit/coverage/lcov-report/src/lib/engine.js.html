<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/lib/engine.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">src/lib/</a> engine.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">6.67% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>9/135</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/78</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">3.45% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/29</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">6.92% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>9/130</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { intersects } from './collision'
&nbsp;
export const PROP_STATIC = 'static'
export const PROP_COLLIDABLE = 'collideable'
export const PROP_KILLER = 'killer'
export const PROP_WIN_ZONE = 'win-zone'
export const PROP_DRAWABLE = 'drawable'
&nbsp;
const BASE_CONFIG = {
  name: '',
  description: '',
  showCollisions: false,
  showVectors: false,
  showGhosts: false
}
&nbsp;
export function loadLevels (levels) <span class="fstat-no" title="function not covered" >{</span>
<span class="cstat-no" title="statement not covered" >  for (let [k, v] of Object.entries(levels)) {</span>
<span class="cstat-no" title="statement not covered" >    levels[k] = initializeLevel(v)</span>
  }
<span class="cstat-no" title="statement not covered" >  return levels</span>
}
&nbsp;
export function initializeLevel ({ config, map }) <span class="fstat-no" title="function not covered" >{</span>
  const level = <span class="cstat-no" title="statement not covered" >{</span>
    config: Object.freeze(Object.assign({}, BASE_CONFIG, config)),
    map
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  level.config = Object.freeze(level.config)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return level</span>
}
&nbsp;
function getRectVertices (a) <span class="fstat-no" title="function not covered" >{</span>
<span class="cstat-no" title="statement not covered" >  return {</span>
    a: { x: a.x, y: a.y },
    b: { x: a.x, y: a.y + a.h },
    c: { x: a.x + a.w, y: a.y + a.h },
    d: { x: a.x + a.w, y: a.y }
  }
}
&nbsp;
function noop () <span class="fstat-no" title="function not covered" >{</span>
  // noop
}
&nbsp;
// A throttling function with a few rules:
//
// - You must start burn while on the floor (dy == 0)
// - Burn starts when global state is up
// - Burn ends after timer, or when parent hits floor (dy == 0)
function throttle (name, burn = 1000, burnFunc = noop) {
  const _data = {}
&nbsp;
  return function _func (obj, data) <span class="fstat-no" title="function not covered" >{</span>
    const now = <span class="cstat-no" title="statement not covered" >Date.now()</span>
    const burndownKey = <span class="cstat-no" title="statement not covered" >`burndown`</span>
    const timerKey = <span class="cstat-no" title="statement not covered" >`timer`</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (obj.dy === 0) {</span>
<span class="cstat-no" title="statement not covered" >      clearTimeout(_data[timerKey])</span>
<span class="cstat-no" title="statement not covered" >      delete _data[burndownKey]</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (_data[burndownKey] == null) {</span>
<span class="cstat-no" title="statement not covered" >      _data[burndownKey] = now + burn</span>
    }
&nbsp;
    let burnRemaining = <span class="cstat-no" title="statement not covered" >0</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (now &lt;= _data[burndownKey]) {</span>
<span class="cstat-no" title="statement not covered" >      burnRemaining = (_data[burndownKey] - now) / 1000</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return burnFunc.call(this, obj, data, burnRemaining)</span>
  }
}
&nbsp;
const accel = throttle('accel', 500,
  function (obj, data, burn) <span class="fstat-no" title="function not covered" >{</span>
<span class="cstat-no" title="statement not covered" >    if (data.state.up &amp;&amp; burn &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      return {</span>
        dy: burn * 1.001
      }
    } else {
<span class="cstat-no" title="statement not covered" >      return {</span>
        dy: obj.dy - 0.08
      }
    }
  }
)
&nbsp;
function furthestExtent (data) <span class="fstat-no" title="function not covered" >{</span>
  const extents = <span class="cstat-no" title="statement not covered" >data.map.map((el) =&gt; <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >el.properties.includes(PROP_STATIC) ? el.x + el.w : 0)</span></span></span>
  const furthestExtent = <span class="cstat-no" title="statement not covered" >Math.max(...extents)</span>
<span class="cstat-no" title="statement not covered" >  return furthestExtent</span>
}
&nbsp;
function atExtents (data) <span class="fstat-no" title="function not covered" >{</span>
  const camera = <span class="cstat-no" title="statement not covered" >data.map.find((el) =&gt; <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >el.type === 'camera')</span></span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return camera.x + camera.w &gt;= furthestExtent(data)</span>
}
&nbsp;
export function move (data, state) <span class="fstat-no" title="function not covered" >{</span>
<span class="cstat-no" title="statement not covered" >  data.state = {...data.state, ...state}</span>
&nbsp;
  const hero = <span class="cstat-no" title="statement not covered" >data.map.find((el) =&gt; <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >el.type === 'hero')</span></span></span>
<span class="cstat-no" title="statement not covered" >  Object.assign(hero, accel(hero, data))</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  data.map = data.map.map((el) =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
    const obj = <span class="cstat-no" title="statement not covered" >Object.assign({}, el)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!obj.properties.includes(PROP_STATIC)) {</span>
<span class="cstat-no" title="statement not covered" >      obj.x0 = el.x</span>
<span class="cstat-no" title="statement not covered" >      obj.y0 = el.y</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      obj.x += state.dt * el.dx</span>
<span class="cstat-no" title="statement not covered" >      obj.y += state.dt * el.dy</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return obj</span>
  })
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (atExtents(data)) {</span>
    const camera = <span class="cstat-no" title="statement not covered" >data.map.find((el) =&gt; <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >el.type === 'camera')</span></span></span>
<span class="cstat-no" title="statement not covered" >    camera.x = furthestExtent(data) - camera.w</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return data</span>
}
&nbsp;
export function isJumping (data) <span class="fstat-no" title="function not covered" >{</span>
  const hero = <span class="cstat-no" title="statement not covered" >data.map.find((el) =&gt; <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >el.type === 'hero')</span></span></span>
<span class="cstat-no" title="statement not covered" >  return hero.dy !== 0</span>
}
&nbsp;
function _detectCollision (a, b) <span class="fstat-no" title="function not covered" >{</span>
  const aV = <span class="cstat-no" title="statement not covered" >getRectVertices(a)</span>
  const a0V = <span class="cstat-no" title="statement not covered" >getRectVertices(Object.assign({}, a, { x: a.x0, y: a.y0 }))</span>
  const bV = <span class="cstat-no" title="statement not covered" >getRectVertices(b)</span>
&nbsp;
  const sides = <span class="cstat-no" title="statement not covered" >[</span>
    ['a', 'b'],
    ['b', 'c'],
    ['c', 'd'],
    ['d', 'a']
  ]
&nbsp;
<span class="cstat-no" title="statement not covered" >  for (const ai in sides) {</span>
<span class="cstat-no" title="statement not covered" >    if (ai) {</span>
      const aSide = <span class="cstat-no" title="statement not covered" >sides[ai]</span>
<span class="cstat-no" title="statement not covered" >      for (const bi in sides) {</span>
<span class="cstat-no" title="statement not covered" >        if (bi) {</span>
          const bSide = <span class="cstat-no" title="statement not covered" >sides[bi]</span>
&nbsp;
          const intersection = <span class="cstat-no" title="statement not covered" >intersects(aV[aSide[0]], a0V[aSide[0]], bV[bSide[0]], bV[bSide[1]]) ||</span>
                               intersects(aV[aSide[0]], aV[aSide[1]], bV[bSide[0]], bV[bSide[1]]) ||
                               intersects(a0V[aSide[0]], a0V[aSide[1]], bV[bSide[0]], bV[bSide[1]]) ||
                               intersects(a0V[aSide[0]], a0V[aSide[1]], bV[bSide[0]], bV[bSide[1]])
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (intersection) {</span>
<span class="cstat-no" title="statement not covered" >            return [intersection, bSide.join('')]</span>
          }
        }
      }
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return null</span>
}
&nbsp;
export function detectCollision (data, map) <span class="fstat-no" title="function not covered" >{</span>
  const collisions = <span class="cstat-no" title="statement not covered" >[]</span>
  const collidables = <span class="cstat-no" title="statement not covered" >{</span>
    heros: [],
    static: []
  }
<span class="cstat-no" title="statement not covered" >  map.reduce((m, o) =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
<span class="cstat-no" title="statement not covered" >    if (!o.properties.includes(PROP_STATIC) &amp;&amp; o.properties.includes(PROP_COLLIDABLE)) {</span>
<span class="cstat-no" title="statement not covered" >      m.heros.push(o)</span>
    } else <span class="cstat-no" title="statement not covered" >if (o.properties.includes(PROP_COLLIDABLE)) {</span>
<span class="cstat-no" title="statement not covered" >      m.static.push(o)</span>
    }
<span class="cstat-no" title="statement not covered" >    return m</span>
  }, collidables)
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (data.state.showCollisions) {</span>
<span class="cstat-no" title="statement not covered" >    map.forEach(o =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
<span class="cstat-no" title="statement not covered" >      o.inCollision = false</span>
    })
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  collidables.heros.forEach((a) =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
<span class="cstat-no" title="statement not covered" >    collidables.static.forEach((o) =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
<span class="cstat-no" title="statement not covered" >      if (a === o) {</span>
<span class="cstat-no" title="statement not covered" >        return</span>
      }
&nbsp;
      const collision = <span class="cstat-no" title="statement not covered" >_detectCollision(a, o)</span>
<span class="cstat-no" title="statement not covered" >      if (collision) {</span>
        const [intersection, side] = <span class="cstat-no" title="statement not covered" >collision</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (data.state.showCollisions) {</span>
<span class="cstat-no" title="statement not covered" >          a.inCollision = true</span>
<span class="cstat-no" title="statement not covered" >          o.inCollision = true</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        collisions.push([a, o, intersection, side])</span>
      }
    })
  })
&nbsp;
<span class="cstat-no" title="statement not covered" >  return collisions</span>
}
&nbsp;
function pathag (a, b) <span class="fstat-no" title="function not covered" >{</span>
<span class="cstat-no" title="statement not covered" >  return Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2))</span>
}
&nbsp;
function sortCollisions (a, b) <span class="fstat-no" title="function not covered" >{</span>
  const da = <span class="cstat-no" title="statement not covered" >pathag(a[2].dx, a[2].dy)</span>
  const db = <span class="cstat-no" title="statement not covered" >pathag(b[2].dx, b[2].dy)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (da &lt; db) {</span>
<span class="cstat-no" title="statement not covered" >    return -1</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (da &gt; db) {</span>
<span class="cstat-no" title="statement not covered" >    return 1</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return 0</span>
}
&nbsp;
function filterCollisions (collision) <span class="fstat-no" title="function not covered" >{</span>
  const collisionDistance = <span class="cstat-no" title="statement not covered" >pathag(collision[2].dx, collision[2].dy)</span>
<span class="cstat-no" title="statement not covered" >  return collisionDistance &gt; 0.1</span>
}
&nbsp;
export function handleCollisions (data, collisions) <span class="fstat-no" title="function not covered" >{</span>
<span class="cstat-no" title="statement not covered" >  if ((collisions &amp;&amp; collisions.length === 0) || data.state.isWinner === true) {</span>
<span class="cstat-no" title="statement not covered" >    return data</span>
  }
&nbsp;
  const closestCollision = <span class="cstat-no" title="statement not covered" >collisions.sort(sortCollisions)[0]</span>
  const nearCollisions = <span class="cstat-no" title="statement not covered" >collisions.filter(filterCollisions, {})</span>
&nbsp;
  // Allow hero to move once per axis, this is to handle pinch points between
  // two static objects and a collider. This is necessary to prevent the
  // movement of the same hero along a single axis. This could be avoided if
  // the data model was immutable.
  let hasMovedX = <span class="cstat-no" title="statement not covered" >false</span>
  let hasMovedY = <span class="cstat-no" title="statement not covered" >false;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  [closestCollision, ...nearCollisions].forEach((col) =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
    const [hero, collision, intersection, side] = <span class="cstat-no" title="statement not covered" >col</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (collision.type === 'platform' &amp;&amp; hero.dy &lt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      hero.y += intersection.dy</span>
<span class="cstat-no" title="statement not covered" >      hero.dy = 0</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (collision.properties.includes(PROP_KILLER)) {</span>
<span class="cstat-no" title="statement not covered" >      data.state.isAlive = false</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (collision.properties.includes(PROP_WIN_ZONE)) {</span>
<span class="cstat-no" title="statement not covered" >      data.state.isWinner = true</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (collision.properties.includes(PROP_COLLIDABLE)) {</span>
<span class="cstat-no" title="statement not covered" >      if (side === 'da' &amp;&amp; hasMovedY === false) {</span>
<span class="cstat-no" title="statement not covered" >        hero.y += intersection.dy - hero.h</span>
<span class="cstat-no" title="statement not covered" >        hasMovedY = true</span>
      } else <span class="cstat-no" title="statement not covered" >if (side === 'ab' &amp;&amp; hasMovedX === false) {</span>
<span class="cstat-no" title="statement not covered" >        hero.x += intersection.dx - hero.w</span>
<span class="cstat-no" title="statement not covered" >        hasMovedX = true</span>
      } else <span class="cstat-no" title="statement not covered" >if (side === 'bc' &amp;&amp; hero.dy &lt; 0 &amp;&amp; hasMovedY === false) {</span>
<span class="cstat-no" title="statement not covered" >        hero.y += intersection.dy</span>
<span class="cstat-no" title="statement not covered" >        hasMovedY = true</span>
      } else <span class="cstat-no" title="statement not covered" >if (side === 'cd' &amp;&amp; hasMovedX === false) {</span>
<span class="cstat-no" title="statement not covered" >        hero.x += intersection.dx</span>
<span class="cstat-no" title="statement not covered" >        hasMovedX = true</span>
      }
    }
  })
&nbsp;
<span class="cstat-no" title="statement not covered" >  return data</span>
}
&nbsp;
export function createFrame (data) <span class="fstat-no" title="function not covered" >{</span>
  // turn data into a single flat frame filled with objects to paint
<span class="cstat-no" title="statement not covered" >  return data</span>
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Jun 30 2021 07:27:48 GMT-0400 (Eastern Daylight Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
